### LOG

基本都是我的胡思乱想的记录，用于记录思维过程，因此比较随意. 其中或许也混杂着一些好东西（

---

$$
{n\brace k}={n-1\brace k-1}+k{n-1\brace k}\\
\Delta_n\left(\dfrac1{k^{n}}{n\brace k}\right)=\dfrac1{k^{n+1}}{n\brace k-1}\\
\sum\dfrac1{k^{n+1}}{n\brace k-1}\delta n=\dfrac1{k^{n}}{n\brace k}+C\\
\sum\nolimits_0^n k^{n-x-1}{x\brace k-1}\delta x={n\brace k}-[k=0]\\
\sum_{i=0}^{n-1} k^{n-i-1}{i\brace k-1}={n\brace k}-[k=0]\\
\sum_{i=0}^{n-1} k^{n-i-1}{i\brace k-1}={n\brace k}-[k=0]\\
$$

上面那一堆没用，推着玩. 

---

$$
\mu(n)^2=\sum_{d^2\mid n}\mu(d)
$$
这个有用，就是把 $n$ 的质因数分解中指数为1的去掉（不贡献 $d$），指数大于2的变成2（不贡献 $\mu$），然后考虑 $d$ 取出 $k$ 个质数的情况数为 $\displaystyle\binom{m}{k}$ （$m$ 为质数个数），上述和就是 $\displaystyle \sum_{i=0}^m(-1)^{i}\binom mi=(1-1)^m=[m=0]$，当 $m=0$ 即无平方因子时为 $1$，否则为 $0$，恰好等于左边. 

这玩意可以求前缀和（SFN 计数）
$$
\begin{align}
\sum_{n=1}^N\mu(n)^2&=\sum_{n=1}^N\sum_{d^2\mid n}\mu(d)\\
&=\sum_d\mu(d)\sum_{n=1}^N[d^2\mid n]\\
&=\sum_d\mu(d)\lfloor\dfrac N{d^2}\rfloor\\
\end{align}
$$
正常求是根号，预处理 $S_\mu$ 整除分块是 $\Theta(n^{1/3})$. （题解说四次根号是不对的，不能简单认为整除分块就是开根号，要去类似根号分治地均值一下证不同数的个数的上界. 一般地，分母是求和变量的 $k$ 次方时复杂度是 $k+1$ 次根号，应该是这个结论吧我忘了. ）

次日补充：上面那一堆是啥玩意啊，我怎么用 $\mu$ 的通项把 $\mu*\mathrm{I}=\delta$ 证了一遍，我昨晚在想啥？？话说某些劣质博客里面出现过类似证明，是因为他们直接用通项定义 $\mu$，然后反过来用二项式定理证卷积式子. 真够反人类的. 

实际上就是反演嘛，哪有那么复杂，直接正常搞就完事了（写算法篇习题解答里了. ）

好数什么的也一样的. 所谓的枚举指数用 $\mu$ 当系数容斥不就是枚举最大指数的约数. 

又补充：最前面那个 $\mu$ 平方公式根本不用记，记了也没用，遇到一个记一个怎么可能记得完. 而且那个求和变量写得有迷惑性，应该写成 $d\mid \max\{d:d^2\mid n\}$，明白我的意思吧. 

补充上条：max里面的d和外面的d无甚关系，字母不够了. 

再次日补充：想出题. 

---

$$
\begin{align}
&\ \ \ \ \sum_{p\le\sqrt N}\log_pN\\
&=\sum_{p\le\sqrt N}\dfrac{\ln N}{\ln P}\\
&=\sum_{k}[k\ln k\le\sqrt N]\dfrac{\ln N}{\ln(k\ln k)}\\
\end{align}
$$

干啥呢. 不是瓶颈. 不要浪费时间. 

>QF P139 幸运数字 $\sigma$ 计数. 

尝试搞一下 DFS 的复杂度. 
$$
T(n,i)=
$$
搞不出来……这怎么能搞出来啊. 

能否放宽了毛估估，比如 $n$ 的 $\log n$ 个素因子随便组合，总共的组合数是贝尔数. OEIS A000110，貌似是指数级别的？……这不又回去了. 

是否n=奇素数的大于1次幂时都无解？

貌似没道理无解……懒得打表找规律了. 

---

整理一些最短路相关结论. 

**一、最短路图**

**定义**：对于一带权有向图 $G=(V,E)$，设源点为 $s$（要求满足**无从 $s$ 出发能到达的负环**），对于点 $u$，用 $dis(u)$ 表示 $s$ 到 $u$ 的最短路长度. 显然 $dis(s)=0$（因为无负环）. 

良定说明：由于不可到达负环，显然最短路存在. 另一方面，若可到达负环，环上的点（及环能到达的点）都没有最短路了，所以下面都不考虑这种情况. 

**三角不等式**：$\forall(u,v,w)\in E,\ dis(v)\le dis(u)+w$. 

证明：显然成立，否则 $dis(v)$ 不满足最短路定义（可用 $dis(u)$ 更新 $dis(v)$）. 

**定义**：若**存在一条**最短路（终点任意）包含边 $e$，则称 $e$ 为**最短路边**. 

**定理 1**： $(u,v,w)$ 为最短路边，**当且仅当** $dis(v)=dis(u)+w$. 

证明：若一条边是最短路边，意味着从 $s$ 走到 $u$ 再走边 $(u,v,w)$ 走出的路径是一条最短路. 这条路的长度是 $dis(u)+w$，因为它是最短路，所以它等于 $dis(u)$（听上去像是废话）. 

**定义**：图 $G$ 的**所有最短路边**构成的图称为**最短路图**. 

**定理 2**：一条从 $s$ 到 $u$ 的路径 $(v_0=s,v_1,v_2,\cdots,v_k=u)$ 是最短路径，当且仅当**它（的每条边）都在最短路图上**. 

证明：必要性显然（最短路径上的边都是最短路边，最短路边一定在最短路图上，全是定义（废话））. 

充分性证明如下：对于边 $(v_i,v_{i+1},w_i)$，它在最短路上（是最短路边），由定理 1 得 $w_i=dis(v_{i+1})-dis(v_i)$，把所有 $w_i$ 加起来求一下路径长度（懒得打求和式了），发现全都裂项相消了，$dis(s)=0$ 没了，只剩下 $dis(u)$ 即为路径长. 说明这条路径的长度等于最短路长，因此这条路径是最短路（又在说废话）. 

**定理 3**：若图 $G$ 中不存在 $s$ 能到达的**零环**，则**最短路图为 DAG（无环）**. 

证明：若存在环，考察从 $s$ 出发绕这个环（都是最短路径了肯定能到达）转很多很多圈，不管绕多少圈都是最短路，说明这个环是零环（因为最短路长度唯一（废话），先后到达一个点走过的距离是相同的），矛盾. 

**二、SPFA**

首先考虑 Bellman-Ford 算法：设 $dis[k][u]$ 为**走不超过 $k$ 条边到达 $u$ 的路径的最短长度**. 对于某一个 $k$，通过**枚举全体边**计算 $dis[k]$. 具体来说，边数比 $k$ 少的路径已经贡献过了，只须计算边数恰为 $k$ 的路径. **枚举路径的最后一条边 $(u,v,w)$**，从 $s$ 到 $u$ 走一条边数不多于 $k-1$ 的路径（最短长度是 $dis[k-1][u]$），贡献给 $dis[k][v]$. 这一步在事实上检查了每条不满足三角不等式的边并使其满足不等式，因此又叫“**松弛**”. 显然最短路的边数不超过 $n-1$，因此 $dis[n-1]$ 就是所要的最短路数组. 复杂度 $O(nm)$. 

> 这里说的不严谨. 若存在零环，则最短路的边数**可以**比 $n-1$ 大，但此时对于任意点 $u$，**一定存在**边数不超过 $n-1$ 的最短路（因为零环可以消去），算法依然正确. 

注意到每次转移时，只有上一轮更新的 $dis[k-1][u]$ 才会对这一轮的 $dis[k-1][v]$ 有影响（或者说，$(u,v,w)$ 才可能不满足三角不等式）. 因此可以用队列维护被更新的点，每次松弛成功将点入队，再从队首取出点更新别的点，直到队列为空，算法结束. 这种队列优化的 Bellman Ford 算法便是所谓的 SPFA. 

**三、判负环**

Bellman Ford 判负环是容易的，只要**在 $n-1$ 轮松弛完毕后仍有边能松弛（不满足三角不等式）**，说明有负环. 

SPFA 因为不显式分层，实现起来比较麻烦. 推荐的做法是判断是否**存在一条边被松弛超过 $n-1$ 次**. 当然也可以直接在转移 $dis$ 的同时转移 $len$（最短路长度），判断是否有 $len>n-1$. 或者也可以记录队列的层数. 

一种常见的写法是判断是否存在一个**点**被松弛超过 $n-1$ 次. 这样做是正确的，但不推荐，因为这样退出更晚. 而且，这样做必须**保证任何时刻队列中没有重复的点**，否则算法错误（**同一轮会重复入队**，导致点松弛次数可能大于算法轮数）.（虽然这种错误的做法能过模板题，但会被第一篇题解 hack. ）

> 注意：我认为无论判不判负环都必须保证队中无重复点，否则复杂度可能会错，但我没有证据. 我只是发现原有的复杂度证明不能起效，因为如果上一轮点 $u$ 重复入队，本轮点 $u$ 的**出边会枚举多次**. 虽然，很多人写的代码都不判重复入队. 

注意：图可能不联通（可能存在源点不能到达的负环），必须建超级源，与每个点相连. 

> 如果你建了超级源，你的点数就加一了. 你判次数的时候就要大于 $n$ 而不是大于等于 $n$. 
>
> 另外，模板题不需要建超级源. 请仔细审题. 

更正：实际上是必须保证队中无重复点的，否则复杂度会假. 已经构造出 hack 数据（还没造，懒了）. 

---

3月11日 xcs 模拟赛笔记：

A 是状压 dp，关键在于注意到 $n$ 对 pair 的答案最大为 $n-1$，因此更优的答案**一定不连通**，即可枚举其中一个连通块作为子问题. 复杂度是枚举子集的 $3^n$. （我认为可以有更优做法，但还没想出来. ）

cq 教了我一种枚举子集的方法，非常神奇（原理类似 `lowbit`，每次把最低的 $1$ 抹掉并把后面的 $1$ 全部恢复）：

```cpp
for(auto T{S}; T; T=(T-1)&S) // 枚举S的子集T
```

B 是经典套路，发现普通幂的指数不好做差分，于是普通幂转下降幂，复杂度少乘一个次数. 

普通幂转下降幂：
$$
x^n=\sum_k{n\brace k}x^{\underline k}
$$
斯特林子集数（第二类斯特林数）的递推公式：
$$
{n\brace k}={n-1\brace k-1}+k{n-1\brace k}\\

{n\brace0}=[n=0],\quad{0\brace k}=[k=0]
$$
下降幂差分：
$$
(x+1)^{\underline k}-x^{\underline k}=\Delta(x^{\underline k})=kx^{\underline{k-1}}
$$
C 是神奇分块，极其难写，放弃. 精髓在于抽象出“区间轮廓”，发现轮廓“合并”的复杂度过高，用分块+二分解决. 

---

这几天写莫队踩了一大堆坑，记录如下：

- 带修莫队，`modify` 判断第 $t$ 次修改是否位于 $[l,r)$ 内，注意端点取舍. 无论在不在，都要 `swap`！
- 注意块长要对 $1$ 取 `max`，对 $n$ 取 `min`！
- 注意区间是集合还是序列，如果有序，要注意添加、删除的顺序. 
- 给 `QUERY` 写了比较函数之后，记得调 `sort`！
- 回滚莫队若当前块编号不等于上一次块编号 `lstpos`，要更新 `lstpos`. 
- 如 SP20644，即使值域很小不用离散化，也得小心值是负数……
- 没事别写回滚莫队. 坑极多. 

另外，可持久化线段树 `modify` 递归调用，要记得调左右子树的，别调自己的（很傻）. 

---

**差分约束**

问题：求一组满足条件的实数 $x_1,\cdots,x_n$，使其满足 $m$ 个形如 $x_i-x_j\le c_k$ 的约束条件. 

容易想到，对于形如 $x_u-x_v\le c_1$ 和 $x_v-x_w\le c_2$ 的两个约束，可将其相加得到新约束 $x_u-x_w\le c_1+c_2$. 因此，构造图 $G$，**对于每条约束 $x_u-x_v\le c_k$ 连边 $v\rightarrow u$（边权 $c_k$）**，这样**图上每条路径都是一个新约束**：如从 $v$ 到 $u$ 有一条长为 $L$ 的路径，则有约束 $x_u-x_v\le L$. 因此，**若图有负环，约束无解**. 

下面考察无负环的图，不妨设 $1$ 可达任意点（否则可建超级源）. 由于差分约束只关心变元间的相对大小，可**规定 $x_1=0$**. 考察从 $1$ 出发到 $u$ 的长为 $L$ 的路径，有 $x_u\le L$.（这里能看出构造边 $v\rightarrow u$ 而非 $u\rightarrow v$ 的意义.）这些不等式中最严格的是 $x_u\le dis(u)$，这就得到**变元值不大于最短路长度**. 

进一步地，由于三角不等式 $dis(u)\le dis(v)+c_k$ 即 $dis(u)-dis(v)\le c_k$ 对任意边都成立，**直接令 $x_u=dis(u)$** 就能保证满足全部约束. 值得注意的是，这组解保证了**每个** $x_u$ 最小（由 $x_u\le dis(u)$），因此也保证了所有 $x_u$ 的**和**最小，这将成为一些题的依据. 

有几个细节问题，由于并不困难，故略（懒得写）. 

---

3月18日 hjy 模拟赛笔记：

hjy 写的题解太抽象了. 只可意会. 不要试图进行长难句分析，要**感受**. 

T1（限制）是简单 dp，一开始想复杂了，浪费了 2h. 后来回头看，很快就切了. 这告诫我们不要在前面的题死磕太久，**一定要确保每道题都想过后再深入思考**. **不要总觉得自己马上就能做出来**.（由于一开始我以为复杂度是三次方，我甚至写了滚动数组以过部分分. 其实它直接就是对的.）

由于题目限制了 $a$ 的全体和为 $n$ 以及 $a$ 恰有 $k$ 个区间和为 $c$，很容易想到前缀和转化. 设 $a$ 的前缀和数组为 $S$，则原有的三个限制变成：$S$ 严格单增；$S_0=0$，$S_{|a|}=n$；恰有 $k$ **对** $(S_i,S_j)$ $(0\le i,j\le |a|)$ 满足 $S_j-S_i=c$. 很显然 $S$ 的顺序已经无所谓了（子区间和变成了单点差），不妨把 $S$ 看成集合（因为没有重复元素），其中必有 $0$ 和 $n$，其他数都在二者之间，可以随便定. 

注意到，如果把 $S$ 中的数按模 $c$ 的余数分成 $c$ 类，则满足条件的数对 $(S_i,S_j)$ 一定在同一个类中（因为二者的差为 $c$）. 换句话说，**有贡献的数对不会跨类**. 进一步地，在每个类内部按大小排序，则**只有相邻两数会产生贡献**. 

把这些类“拍”成一行，使拍成的序列中原先每类的数都相邻（即 $0,c,2c,\cdots,\lfloor\dfrac nc\rfloor c,1,c+1,2c+1,\cdots$）. 通俗地说就是先画一个以 $c$ 为周期的数表（第一行是 $0\sim c-1$，第二行是 $c\sim 2c-1$，……，类似元素周期表），然后**竖着看**. 这样问题变成：在序列中任意选择一些数（除了 $0$ 和 $n$ 必选），使得恰有 $k$ 对相邻（不算两周期接起来的位置），求方案数.（这段我嫌放图麻烦废话很多，其实画个图就理解了.）

设 $f_{i,j,0/1}$ 表示考虑数列的前 $i$ 项（下标从 $0$ 到 $n$）、有 $j$ 对贡献（相邻且同类）、不选/选位置 $i$ 的方案数. 
$$
f_{i,j,0}=f_{i-1,j,0}+f_{i-1,j,1}\\
f_{i,j,1}=f_{i-1,j,0}+[j>0]f_{i-1,j-1,1}
$$
一些细节：

- 如果当前的 $i$ 是该纵列最下面的元素（可以写一些模、除之类的判断，也可以预处理），则它**一定是无后效性的**（选不选和下一个位置都不构成一对贡献），因此把 $f_{i,j,1}$ 加到 $f_{i,j,0}$ 上并清零即可. 
- 为了钦定 $0$ 必选，可直接令 $f_{0,0,1}=1$ 且 $f_{0,0,0}=0$ 作为初始条件. 
- 为了钦定 $n$ 必选，可特判 $n$ 处对 $f$ 特殊处理，但要注意 $n$ 不一定是最后一个 dp 到的. 赛时我直接对 $n+1$ 和 $n$ 做两遍 dp 把答案相减容斥出答案.（我都觉得我很聪明！）

T2 我赛时几乎要想到了（写对了求集合的部分），除了 Hall 定理. 部分分太烂，误了 40pts. 这告诫我们，**对于没有数据验证的代码，千万不能相信自己的瞪眼能力，要倍加谨慎**. 

**Hall 定理**：设有二部图 $(L,R)$，定义**完美 $k$ 匹配**为：每个左部点都匹配 $k$ 个邻接的右部点，并且它们之间不相重复. 则完美 $k$ 匹配**存在当且仅当**

$$
\forall S\sube L,\ \left|\bigcup_{u\in S}T_u\right|\ge k\left|S\right|
$$
其中 $T_u$ 表示左部点 $u$ 的所有邻接点，有 $T_u\sube R$. 

我并不想研究它的证明，故证明略. 必要性是显然的，因此可以通过必要性来记忆定理. 这就是说：如果**对于任意一组左部点，与之相连的右部点都足够多（达到左部点数的 $k$ 倍）**，那么**完美 $k$ 匹配就存在**. 至于怎么找到这个匹配，就不是我们（或者说 Hall 定理）需要干的事了. 

回到本题. 首先注意到**汇合点一定是所有起始点的 LCA**. 通过**乱搞**（树上莫队、树剖之类的）求出每个起始点到 LCA 经过的物品集合（bitset 压位），然后就变成了完美 $k$ 匹配问题：$L$ 是人，$R$ 是物品，若某人能拿某物品就连边，希望总物品数（每个人拿的物品数 $k$ 乘 $c$）最大. 这里是要求 $k$ 的最大值，由于 $c$ 足够小，可以枚举左部点，用 bitset 求出对应右部点，二者的大小相除，取商的最小值即为 $k$. 

这里应当补充“扫描线”求集合的方法. 方法很简单，只是利用了离线省空间. 先略了. 

T3 很有意思. 首先是一般树的**三度化**——转成二叉树，使得分治可行（点分治比较麻烦，边分治是保证复杂度）. 然后是对于正负的巧妙设计. 懒得写了，看题解吧. 

---

3月25日广州二中模拟赛笔记：

题解太差了. 比上周 hjy 写的差多了. 不要试图进行长难句分析，不要试图感受，**作者根本没学过语文**. 

看见了吧，这就是停文化课的后果.（

T1 是简单状压 dp，有一个前缀和优化的小技巧. **别想复杂**. 要精准清空. 

T2 是扫描线，但是无法直接维护，要用到平面图面计数的**欧拉公式**
$$
V-E+F-C=1
$$
其中 $F$ 为**面数**，$C$ 为连通块个数. 由于这是网格图的一部分，有 $E=2V-n$，其中 $n$ 为线段数（输入）. $V$ 的求解是经典扫描线，$C$ 要在扫描线的过程中**维护并查集**，并查集中的点是**线段**（输入）. 可以**用线段树维护区间并查集合并**.（也可以再用一个“并查集”，实质是路径压缩的双向链表.）

T3 没看题. 

---

（近些天的）其他零散的感受：

打比赛**切莫眼高手低**. 拿一分是一分. 

很多人并没有你想象的那样强，或者至少他们是可以追赶的. **要有自信**. 

很多题并没有你想象的那样难，但它们很容易想复杂，这样不好. **别想复杂**. 

很多时候你想出来了 99% 却因为剩下那 1% 没做出来，这个时候应该庆幸而不是埋怨自己，因为补上 1% 总比补上 100% 要容易. **任何时候这都不是最后一次机会**. **别慌**. 

（hjy 你能不能别“这么猛”了. 我受不了了. 我已经被你们班“这么强！”折磨坏了.）

（哈哈哈哈哈哈反正你也看不着这些. 我可以随便骂.）

> 3月31日补充：这两天发现“这么猛”也挺可爱的. 仅限 hjy 和 smy. 

状态好多了. 未来的事就不要瞎操心了. 

---

3月27日（懒得一天一 commit 只好人工写下日期）

hjy 你都发烧了还想着打模拟赛呢. 烧糊涂了吧……

省选前好不了你就完了. 还是生病太少，没有警惕心，自以为自己很厉害，能恢复状态. 这就是平常身体不错的人的傲慢！（

---

来点活学活用，作为以后骂自己的素材：

> 重重的顾虑使我们全变成了懦夫，决心的赤热的光彩，被审慎的思维盖上了一层灰色，伟大的事业在这一种考虑下，也会逆流而退，失去了行动的意义. ——《哈姆莱特》

担心这个担心那个，瞻前顾后眼高手低，想那么多干啥啊……真是. 

感觉找回了一些自信. 果然自信对于状态的维持是极为重要的，一定要**相信自己在做的事是对的**. 

---

3月28日

果然我还是不怎么会（在言语上）关心人…… 好在这种情况下说什么不是很重要（

cq 让我看 qfoj.cn/d/rui_er__sqrt_7/p/3. 先拖着不看，明天再说.（谁教你题面写肾蕨的！）

smy 杂题选讲有 2 道神奇题，已补 T2（需要抽时间写题解），T1 仍需回味……

昨天写了 5*5 神奇状压 dp，又应用了**“从小往大填数”的技巧**. 

写了 n=70 更神奇状压 dp. 

**hjy 学第一定律**：“hhh”表示“我看到了/已阅/你说的是对的/哦/嗯”；“hhhhh”才表示“哈哈哈哈哈好好笑”.（更多的“h”可以表示非常非常好笑.）

**hjy 学第二定律**：连续的“h”数量为奇数的概率远大于偶数.（宇称不守恒？）

**hjy 学第三定律**：通常来讲左右括号应当匹配，但也有例外.（电荷守恒？）

> 解释一下为什么不叫“hjy 第几定律”：通常来讲第几定律前的人名是发现者，带上“学”字才代表定律的研究对象.（例如牛顿/孟德尔第一定律、热力学第一定律等.）

---

3月29日

hjy 身体好了，居然看着还挺精神的，不愧是 hjy，好得真快. 应当只是前一阵太累了. 

回味了 smy 杂题选讲 T1. **神**. 用巧妙的费用提前计算解决了后效性问题，省掉了一维状态，再按最短路算法的顺序更新状态，并维护凸壳均摊转移复杂度. 

近些天明显感觉到写代码能力显著提升. 还是**要多写**. 

---

3月31日

smy 居然也发烧了…… hjy 还咳得很厉害……

我到现在还没事，这已经是一个奇迹了，我就暗自庆幸吧. 

明天就省选了. 其实我也没啥压力，毕竟进不了队就没有不确定性（

---

4月1日

发挥得居然还不错，果然心态和自信是最重要的……

各种尝试安慰 hjy. 

担心 T1 有没有写挂. 

反思一下的话，就是**有什么想法/思路应该赶快写到纸上**，不要觉得不重要/没时间做. 本来最后剩下半小时完全够卡 T2 常的，结果因为脑子乱了不清晰，没卡完，损失 20pts.（当然这都是乐观情况，万一挂分就没这些事了.）

好消息：T1 T3 没挂. 坏消息：T2 挂了. 好消息：T2 没有完全挂. 

挂多少看~~天意~~ ccf 数据. 多则 25，少则不挂. 
$$
100+45+48=193
$$

$$
100+20+48=168
$$

比想象中好很多啊，看来. 

T3 能一眼秒 48 全靠 smy 和 hjy 前一阵给我速通了 Dsu on Tree……（但是 hjy 没想到就很可惜啊！！！）所以 hjy 和 smy 在 oi 上真的给了我很大很大的帮助，帮他们补 whk 是当然应该做的事，无论是理性上还是感情上.（求你们这些不搞 oi 的别问我竞赛集训情况/为什么不停课/小黄文化课怎么办/小黄落下的课找谁补/……了！！！我真的已经烦死了！！！！！以后再问回答一律是：搞什么竞赛，傻子才搞竞赛，我才不学竞赛呢！）

---

4月2日

（听得出 hjy 咳嗽少多了. 好得真快.）

今天 T1 的事我不想写了，这事我能记一辈子. 

谁能想到这么巧，去年 7 月打过 ABC261H 原题，但我和 hjy 都没认真研究题解；今年 2 月模拟赛也有原题，但我恰好去医院了没打（hjy 去上 zhengrui 也恰好没打）；省选考场上又给碰见了. 这就是**命运**啊！

> 【问题】给定有向图 $G$，初始在起点 $s$ 有一个棋子. Alice 和 Bob 轮流操作，每次将这枚棋子沿有向边移到相邻点，无法移动的人输. 判断游戏的结果是哪方获胜或平局（无法终止）. 

【分析】由于 Alice 和 Bob 的身份是没有区别的，因此我们可以将每个点区分为“**必胜点**”“**必败点**”“**平局点**“三种之一. 在求解过程中，初始所有点的种类都**未确定**，我们可以以任意顺序进行如下操作（称点 $u$ 能直接到达的点为 $u$ 的邻接点）：

- 若点 $u$ 的**所有邻接点都已确定是必胜点**（或点 $u$ 无邻接点），将其设为必败点. 
- 若点 $u$ **存在一个邻接点已确定是必败点**，将其设为必胜点. 

它们的正确性显然. 下面要说明的是，如果无法进行上述两条操作，那么**未确定的点就是平局点**. 这是因为，对于最终未确定的点 $u$，由于无法进行操作，它的所有邻接点**都不是必败点、不都是必胜点**（即存在未确定的邻接点）. 如果此时走棋的人位于 $u$，他显然不会往必胜点走，但又走不到必败点，因此只能（并且一定可以）走到另一个未确定的点. 因此，无论走多少步，棋子永远在未确定的点上，这就说明这些点就是平局点. 

【解法】建反图. 找到任意一个入度为零的点 $u$，将 $u$ 设为必败点，将 $u$ 的所有（反图上的）邻接点设为必胜点，并把它们一并从反图上删去. 直到反图中不存在入度为零的点，终止算法. 可用队列维护这个过程，复杂度线性. 

> 【问题加强版】若起点 $s$ 是非平局点，必胜方希望以最少的步数胜利，必败方希望以最多的步数失败，求两人在最优策略下游戏终止时的总步数 $d(s)$. 

【解法】删去点 $u$ 时更新 $u$ 的所有邻接点的 $d$ 值即可. 

---

4月12日

smy 进队了. 

居然真的进队了！

仿佛活在梦里一样……

（担心 hjy 的心理状态……）

---

4月22日

期中考前最后一天周末在家看抽代. 不愧是我！

如果有一个“最丑数学”排行榜，那么**高中导数大题**一定是榜首. 

---

4月24日

终于get到商群为什么叫商群了！同时也感受到第一同构定理在干什么了！……

都是明天数学不考的东西（（

---

