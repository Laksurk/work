### LOG

---

$$
{n\brace k}={n-1\brace k-1}+k{n-1\brace k}\\
\Delta_n\left(\dfrac1{k^{n}}{n\brace k}\right)=\dfrac1{k^{n+1}}{n\brace k-1}\\
\sum\dfrac1{k^{n+1}}{n\brace k-1}\delta n=\dfrac1{k^{n}}{n\brace k}+C\\
\sum\nolimits_0^n k^{n-x-1}{x\brace k-1}\delta x={n\brace k}-[k=0]\\
\sum_{i=0}^{n-1} k^{n-i-1}{i\brace k-1}={n\brace k}-[k=0]\\
\sum_{i=0}^{n-1} k^{n-i-1}{i\brace k-1}={n\brace k}-[k=0]\\
$$

上面那一堆没用，推着玩. 

---

$$
\mu(n)^2=\sum_{d^2\mid n}\mu(d)
$$
这个有用，就是把 $n$ 的质因数分解中指数为1的去掉（不贡献 $d$），指数大于2的变成2（不贡献 $\mu$），然后考虑 $d$ 取出 $k$ 个质数的情况数为 $\displaystyle\binom{m}{k}$ （$m$ 为质数个数），上述和就是 $\displaystyle \sum_{i=0}^m(-1)^{i}\binom mi=(1-1)^m=[m=0]$，当 $m=0$ 即无平方因子时为 $1$，否则为 $0$，恰好等于左边. 

这玩意可以求前缀和（SFN 计数）
$$
\begin{align}
\sum_{n=1}^N\mu(n)^2&=\sum_{n=1}^N\sum_{d^2\mid n}\mu(d)\\
&=\sum_d\mu(d)\sum_{n=1}^N[d^2\mid n]\\
&=\sum_d\mu(d)\lfloor\dfrac N{d^2}\rfloor\\
\end{align}
$$
正常求是根号，预处理 $S_\mu$ 整除分块是 $\Theta(n^{1/3})$. （题解说四次根号是不对的，不能简单认为整除分块就是开根号，要去类似根号分治地均值一下证不同数的个数的上界. 一般地，分母是求和变量的 $k$ 次方时复杂度是 $k+1$ 此根号，应该是这个结论吧我忘了. ）

次日补充：上面那一堆是啥玩意啊，我怎么用 $\mu$ 的通项把 $\mu*\mathrm{I}=\delta$ 证了一遍，我昨晚在想啥？？话说某些劣质博客里面出现过类似证明，是因为他们直接用通项定义 $\mu$，然后反过来用二项式定理证卷积式子. 真够反人类的. 

实际上就是反演嘛，哪有那么复杂，直接正常搞就完事了（写算法篇习题解答里了. ）

好数什么的也一样的. 所谓的枚举指数用 $\mu$ 当系数容斥不就是枚举最大指数的约数. 

又补充：最前面那个 $\mu$ 平方公式根本不用记，记了也没用，遇到一个记一个怎么可能记得完. 而且那个求和变量写得有迷惑性，应该写成 $d\mid \max\{d:d^2\mid n\}$，明白我的意思吧. 

补充上条：max里面的d和外面的d无甚关系，字母不够了. 

再次日补充：想出题. 

---

$$
\begin{align}
&\ \ \ \ \sum_{p\le\sqrt N}\log_pN\\
&=\sum_{p\le\sqrt N}\dfrac{\ln N}{\ln P}\\
&=\sum_{k}[k\ln k\le\sqrt N]\dfrac{\ln N}{\ln(k\ln k)}\\
\end{align}
$$

干啥呢. 不是瓶颈. 不要浪费时间. 

>QF P139 幸运数字 $\sigma$ 计数. 

尝试搞一下 DFS 的复杂度. 
$$
T(n,i)=
$$
搞不出来……这怎么能搞出来啊. 

能否放宽了毛估估，比如 $n$ 的 $\log n$ 个素因子随便组合，总共的组合数是贝尔数. OEIS A000110，貌似是指数级别的？……这不又回去了. 

是否n=奇素数的大于1次幂时都无解？

貌似没道理无解……懒得打表找规律了. 

---

整理一些最短路相关结论. 

**一、最短路图**

**定义**：对于一带权有向图 $G=(V,E)$，设源点为 $s$（要求满足**无从 $s$ 出发能到达的负环**），对于点 $u$，用 $dis(u)$ 表示 $s$ 到 $u$ 的最短路长度. 显然 $dis(s)=0$（因为无负环）. 

良定说明：由于不可到达负环，显然最短路存在. 另一方面，若可到达负环，环上的点（及环能到达的点）都没有最短路了，所以下面都不考虑这种情况. 

**三角不等式**：$\forall(u,v,w)\in E,\ dis(v)\le dis(u)+w$. 

证明：显然成立，否则 $dis(v)$ 不满足最短路定义（可用 $dis(u)$ 更新 $dis(v)$）. 

**定义**：若**存在一条**最短路（终点任意）包含边 $e$，则称 $e$ 为**最短路边**. 

**定理 1**： $(u,v,w)$ 为最短路边，**当且仅当** $dis(v)=dis(u)+w$. 

证明：若一条边是最短路边，意味着从 $s$ 走到 $u$ 再走边 $(u,v,w)$ 走出的路径是一条最短路. 这条路的长度是 $dis(u)+w$，因为它是最短路，所以它等于 $dis(u)$（听上去像是废话）. 

**定义**：图 $G$ 的**所有最短路边**构成的图称为**最短路图**. 

**定理 2**：一条从 $s$ 到 $u$ 的路径 $(v_0=s,v_1,v_2,\cdots,v_k=u)$ 是最短路径，当且仅当**它（的每条边）都在最短路图上**. 

证明：必要性显然（最短路径上的边都是最短路边，最短路边一定在最短路图上，全是定义（废话））. 

充分性证明如下：对于边 $(v_i,v_{i+1},w_i)$，它在最短路上（是最短路边），由定理 1 得 $w_i=dis(v_{i+1})-dis(v_i)$，把所有 $w_i$ 加起来求一下路径长度（懒得打求和式了），发现全都裂项相消了，$dis(s)=0$ 没了，只剩下 $dis(u)$ 即为路径长. 说明这条路径的长度等于最短路长，因此这条路径是最短路（又在说废话）. 

**定理 3**：若图 $G$ 中不存在 $s$ 能到达的**零环**，则**最短路图为 DAG（无环）**. 

证明：若存在环，考察从 $s$ 出发绕这个环（都是最短路径了肯定能到达）转很多很多圈，不管绕多少圈都是最短路，说明这个环是零环（因为最短路长度唯一（废话），先后到达一个点走过的距离是相同的），矛盾. 

**二、SPFA**

首先考虑 Bellman-Ford 算法：设 $dis[k][u]$ 为**走不超过 $k$ 条边到达 $u$ 的路径的最短长度**. 对于某一个 $k$，通过**枚举全体边**计算 $dis[k]$. 具体来说，边数比 $k$ 少的路径已经贡献过了，只须计算边数恰为 $k$ 的路径. **枚举路径的最后一条边 $(u,v,w)$**，从 $s$ 到 $u$ 走一条边数不多于 $k-1$ 的路径（最短长度是 $dis[k-1][u]$），贡献给 $dis[k][v]$. 这一步在事实上检查了每条不满足三角不等式的边并使其满足不等式，因此又叫“**松弛**”. 显然最短路的边数不超过 $n-1$，因此 $dis[n-1]$ 就是所要的最短路数组. 复杂度 $O(nm)$. 

> 这里说的不严谨. 若存在零环，则最短路的边数**可以**比 $n-1$ 大，但此时对于任意点 $u$，**一定存在**边数不超过 $n-1$ 的最短路（因为零环可以消去），算法依然正确. 

注意到每次转移时，只有上一轮更新的 $dis[k-1][u]$ 才会对这一轮的 $dis[k-1][v]$ 有影响（或者说，$(u,v,w)$ 才可能不满足三角不等式）. 因此可以用队列维护被更新的点，每次松弛成功将点入队，再从队首取出点更新别的点，直到队列为空，算法结束. 这种队列优化的 Bellman Ford 算法便是所谓的 SPFA. 

**三、判负环**

Bellman Ford 判负环是容易的，只要**在 $n-1$ 轮松弛完毕后仍有边能松弛（不满足三角不等式）**，说明有负环. 

SPFA 因为不显式分层，实现起来比较麻烦. 推荐的做法是判断是否**存在一条边被松弛超过 $n-1$ 次**. 当然也可以直接在转移 $dis$ 的同时转移 $len$（最短路长度），判断是否有 $len>n-1$. 或者也可以记录队列的层数. 

一种常见的写法是判断是否存在一个**点**被松弛超过 $n-1$ 次. 这样做是正确的，但不推荐，因为这样退出更晚. 而且，这样做必须**保证任何时刻队列中没有重复的点**，否则算法错误（**同一轮会重复入队**，导致点松弛次数可能大于算法轮数）.（虽然这种错误的做法能过模板题，但会被第一篇题解 hack. ）

> 注意：我认为无论判不判负环都必须保证队中无重复点，否则复杂度可能会错，但我没有证据. 我只是发现原有的复杂度证明不能起效，因为如果上一轮点 $u$ 重复入队，本轮点 $u$ 的**出边会枚举多次**. 虽然，很多人写的代码都不判重复入队. 

注意：图可能不联通（可能存在源点不能到达的负环），必须建超级源，与每个点相连. 

> 如果你建了超级源，你的点数就加一了. 你判次数的时候就要大于 $n$ 而不是大于等于 $n$. 
>
> 另外，模板题不需要建超级源. 请仔细审题. 
