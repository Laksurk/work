### LOG

基本都是我的胡思乱想的记录，用于记录思维过程，因此比较随意. 其中或许也混杂着一些好东西（

---

$$
{n\brace k}={n-1\brace k-1}+k{n-1\brace k}\\
\Delta_n\left(\dfrac1{k^{n}}{n\brace k}\right)=\dfrac1{k^{n+1}}{n\brace k-1}\\
\sum\dfrac1{k^{n+1}}{n\brace k-1}\delta n=\dfrac1{k^{n}}{n\brace k}+C\\
\sum\nolimits_0^n k^{n-x-1}{x\brace k-1}\delta x={n\brace k}-[k=0]\\
\sum_{i=0}^{n-1} k^{n-i-1}{i\brace k-1}={n\brace k}-[k=0]\\
\sum_{i=0}^{n-1} k^{n-i-1}{i\brace k-1}={n\brace k}-[k=0]\\
$$

上面那一堆没用，推着玩. 

---

$$
\mu(n)^2=\sum_{d^2\mid n}\mu(d)
$$
这个有用，就是把 $n$ 的质因数分解中指数为1的去掉（不贡献 $d$），指数大于2的变成2（不贡献 $\mu$），然后考虑 $d$ 取出 $k$ 个质数的情况数为 $\displaystyle\binom{m}{k}$ （$m$ 为质数个数），上述和就是 $\displaystyle \sum_{i=0}^m(-1)^{i}\binom mi=(1-1)^m=[m=0]$，当 $m=0$ 即无平方因子时为 $1$，否则为 $0$，恰好等于左边. 

这玩意可以求前缀和（SFN 计数）
$$
\begin{align}
\sum_{n=1}^N\mu(n)^2&=\sum_{n=1}^N\sum_{d^2\mid n}\mu(d)\\
&=\sum_d\mu(d)\sum_{n=1}^N[d^2\mid n]\\
&=\sum_d\mu(d)\lfloor\dfrac N{d^2}\rfloor\\
\end{align}
$$
正常求是根号，预处理 $S_\mu$ 整除分块是 $\Theta(n^{1/3})$. （题解说四次根号是不对的，不能简单认为整除分块就是开根号，要去类似根号分治地均值一下证不同数的个数的上界. 一般地，分母是求和变量的 $k$ 次方时复杂度是 $k+1$ 次根号，应该是这个结论吧我忘了. ）

次日补充：上面那一堆是啥玩意啊，我怎么用 $\mu$ 的通项把 $\mu*\mathrm{I}=\delta$ 证了一遍，我昨晚在想啥？？话说某些劣质博客里面出现过类似证明，是因为他们直接用通项定义 $\mu$，然后反过来用二项式定理证卷积式子. 真够反人类的. 

实际上就是反演嘛，哪有那么复杂，直接正常搞就完事了（写算法篇习题解答里了. ）

好数什么的也一样的. 所谓的枚举指数用 $\mu$ 当系数容斥不就是枚举最大指数的约数. 

又补充：最前面那个 $\mu$ 平方公式根本不用记，记了也没用，遇到一个记一个怎么可能记得完. 而且那个求和变量写得有迷惑性，应该写成 $d\mid \max\{d:d^2\mid n\}$，明白我的意思吧. 

补充上条：max里面的d和外面的d无甚关系，字母不够了. 

再次日补充：想出题. 

---

$$
\begin{align}
&\ \ \ \ \sum_{p\le\sqrt N}\log_pN\\
&=\sum_{p\le\sqrt N}\dfrac{\ln N}{\ln P}\\
&=\sum_{k}[k\ln k\le\sqrt N]\dfrac{\ln N}{\ln(k\ln k)}\\
\end{align}
$$

干啥呢. 不是瓶颈. 不要浪费时间. 

>QF P139 幸运数字 $\sigma$ 计数. 

尝试搞一下 DFS 的复杂度. 
$$
T(n,i)=
$$
搞不出来……这怎么能搞出来啊. 

能否放宽了毛估估，比如 $n$ 的 $\log n$ 个素因子随便组合，总共的组合数是贝尔数. OEIS A000110，貌似是指数级别的？……这不又回去了. 

是否n=奇素数的大于1次幂时都无解？

貌似没道理无解……懒得打表找规律了. 

---

整理一些最短路相关结论. 

**一、最短路图**

**定义**：对于一带权有向图 $G=(V,E)$，设源点为 $s$（要求满足**无从 $s$ 出发能到达的负环**），对于点 $u$，用 $dis(u)$ 表示 $s$ 到 $u$ 的最短路长度. 显然 $dis(s)=0$（因为无负环）. 

良定说明：由于不可到达负环，显然最短路存在. 另一方面，若可到达负环，环上的点（及环能到达的点）都没有最短路了，所以下面都不考虑这种情况. 

**三角不等式**：$\forall(u,v,w)\in E,\ dis(v)\le dis(u)+w$. 

证明：显然成立，否则 $dis(v)$ 不满足最短路定义（可用 $dis(u)$ 更新 $dis(v)$）. 

**定义**：若**存在一条**最短路（终点任意）包含边 $e$，则称 $e$ 为**最短路边**. 

**定理 1**： $(u,v,w)$ 为最短路边，**当且仅当** $dis(v)=dis(u)+w$. 

证明：若一条边是最短路边，意味着从 $s$ 走到 $u$ 再走边 $(u,v,w)$ 走出的路径是一条最短路. 这条路的长度是 $dis(u)+w$，因为它是最短路，所以它等于 $dis(u)$（听上去像是废话）. 

**定义**：图 $G$ 的**所有最短路边**构成的图称为**最短路图**. 

**定理 2**：一条从 $s$ 到 $u$ 的路径 $(v_0=s,v_1,v_2,\cdots,v_k=u)$ 是最短路径，当且仅当**它（的每条边）都在最短路图上**. 

证明：必要性显然（最短路径上的边都是最短路边，最短路边一定在最短路图上，全是定义（废话））. 

充分性证明如下：对于边 $(v_i,v_{i+1},w_i)$，它在最短路上（是最短路边），由定理 1 得 $w_i=dis(v_{i+1})-dis(v_i)$，把所有 $w_i$ 加起来求一下路径长度（懒得打求和式了），发现全都裂项相消了，$dis(s)=0$ 没了，只剩下 $dis(u)$ 即为路径长. 说明这条路径的长度等于最短路长，因此这条路径是最短路（又在说废话）. 

**定理 3**：若图 $G$ 中不存在 $s$ 能到达的**零环**，则**最短路图为 DAG（无环）**. 

证明：若存在环，考察从 $s$ 出发绕这个环（都是最短路径了肯定能到达）转很多很多圈，不管绕多少圈都是最短路，说明这个环是零环（因为最短路长度唯一（废话），先后到达一个点走过的距离是相同的），矛盾. 

**二、SPFA**

首先考虑 Bellman-Ford 算法：设 $dis[k][u]$ 为**走不超过 $k$ 条边到达 $u$ 的路径的最短长度**. 对于某一个 $k$，通过**枚举全体边**计算 $dis[k]$. 具体来说，边数比 $k$ 少的路径已经贡献过了，只须计算边数恰为 $k$ 的路径. **枚举路径的最后一条边 $(u,v,w)$**，从 $s$ 到 $u$ 走一条边数不多于 $k-1$ 的路径（最短长度是 $dis[k-1][u]$），贡献给 $dis[k][v]$. 这一步在事实上检查了每条不满足三角不等式的边并使其满足不等式，因此又叫“**松弛**”. 显然最短路的边数不超过 $n-1$，因此 $dis[n-1]$ 就是所要的最短路数组. 复杂度 $O(nm)$. 

> 这里说的不严谨. 若存在零环，则最短路的边数**可以**比 $n-1$ 大，但此时对于任意点 $u$，**一定存在**边数不超过 $n-1$ 的最短路（因为零环可以消去），算法依然正确. 

注意到每次转移时，只有上一轮更新的 $dis[k-1][u]$ 才会对这一轮的 $dis[k-1][v]$ 有影响（或者说，$(u,v,w)$ 才可能不满足三角不等式）. 因此可以用队列维护被更新的点，每次松弛成功将点入队，再从队首取出点更新别的点，直到队列为空，算法结束. 这种队列优化的 Bellman Ford 算法便是所谓的 SPFA. 

**三、判负环**

Bellman Ford 判负环是容易的，只要**在 $n-1$ 轮松弛完毕后仍有边能松弛（不满足三角不等式）**，说明有负环. 

SPFA 因为不显式分层，实现起来比较麻烦. 推荐的做法是判断是否**存在一条边被松弛超过 $n-1$ 次**. 当然也可以直接在转移 $dis$ 的同时转移 $len$（最短路长度），判断是否有 $len>n-1$. 或者也可以记录队列的层数. 

一种常见的写法是判断是否存在一个**点**被松弛超过 $n-1$ 次. 这样做是正确的，但不推荐，因为这样退出更晚. 而且，这样做必须**保证任何时刻队列中没有重复的点**，否则算法错误（**同一轮会重复入队**，导致点松弛次数可能大于算法轮数）.（虽然这种错误的做法能过模板题，但会被第一篇题解 hack. ）

> 注意：我认为无论判不判负环都必须保证队中无重复点，否则复杂度可能会错，但我没有证据. 我只是发现原有的复杂度证明不能起效，因为如果上一轮点 $u$ 重复入队，本轮点 $u$ 的**出边会枚举多次**. 虽然，很多人写的代码都不判重复入队. 

注意：图可能不联通（可能存在源点不能到达的负环），必须建超级源，与每个点相连. 

> 如果你建了超级源，你的点数就加一了. 你判次数的时候就要大于 $n$ 而不是大于等于 $n$. 
>
> 另外，模板题不需要建超级源. 请仔细审题. 

更正：实际上是必须保证队中无重复点的，否则复杂度会假. 已经构造出 hack 数据（还没造，懒了）. 

---

3月11日 xcs 模拟赛笔记：

A 是状压 dp，关键在于注意到 $n$ 对 pair 的答案最大为 $n-1$，因此更优的答案**一定不连通**，即可枚举其中一个连通块作为子问题. 复杂度是枚举子集的 $3^n$. （我认为可以有更优做法，但还没想出来. ）

cq 教了我一种枚举子集的方法，非常神奇（原理类似 `lowbit`，每次把最低的 $1$ 抹掉并把后面的 $1$ 全部恢复）：

```cpp
for(auto T{S}; T; T=(T-1)&S) // 枚举S的子集T
```

B 是经典套路，发现普通幂的指数不好做差分，于是普通幂转下降幂，复杂度少乘一个次数. 

普通幂转下降幂：
$$
x^n=\sum_k{n\brace k}x^{\underline k}
$$
斯特林子集数（第二类斯特林数）的递推公式：
$$
{n\brace k}={n-1\brace k-1}+k{n-1\brace k}\\

{n\brace0}=[n=0],\quad{0\brace k}=[k=0]
$$
下降幂差分：
$$
(x+1)^{\underline k}-x^{\underline k}=\Delta(x^{\underline k})=kx^{\underline{k-1}}
$$
C 是神奇分块，极其难写，放弃. 精髓在于抽象出“区间轮廓”，发现轮廓“合并”的复杂度过高，用分块+二分解决. 

---

这几天写莫队踩了一大堆坑，记录如下：

- 带修莫队，`modify` 判断第 $t$ 次修改是否位于 $[l,r)$ 内，注意端点取舍. 无论在不在，都要 `swap`！
- 注意块长要对 $1$ 取 `max`，对 $n$ 取 `min`！
- 注意区间是集合还是序列，如果有序，要注意添加、删除的顺序. 
- 给 `QUERY` 写了比较函数之后，记得调 `sort`！
- 回滚莫队若当前块编号不等于上一次块编号 `lstpos`，要更新 `lstpos`. 
- 如 SP20644，即使值域很小不用离散化，也得小心值是负数……
- 没事别写回滚莫队. 坑极多. 

另外，可持久化线段树 `modify` 递归调用，要记得调左右子树的，别调自己的（很傻）. 

---

**差分约束**

问题：求一组满足条件的实数 $x_1,\cdots,x_n$，使其满足 $m$ 个形如 $x_i-x_j\le c_k$ 的约束条件. 

容易想到，对于形如 $x_u-x_v\le c_1$ 和 $x_v-x_w\le c_2$ 的两个约束，可将其相加得到新约束 $x_u-x_w\le c_1+c_2$. 因此，构造图 $G$，**对于每条约束 $x_u-x_v\le c_k$ 连边 $v\rightarrow u$（边权 $c_k$）**，这样**图上每条路径都是一个新约束**：如从 $v$ 到 $u$ 有一条长为 $L$ 的路径，则有约束 $x_u-x_v\le L$. 因此，**若图有负环，约束无解**. 

下面考察无负环的图，不妨设 $1$ 可达任意点（否则可建超级源）. 由于差分约束只关心变元间的相对大小，可**规定 $x_1=0$**. 考察从 $1$ 出发到 $u$ 的长为 $L$ 的路径，有 $x_u\le L$.（这里能看出构造边 $v\rightarrow u$ 而非 $u\rightarrow v$ 的意义.）这些不等式中最严格的是 $x_u\le dis(u)$，这就得到**变元值不大于最短路长度**. 

进一步地，由于三角不等式 $dis(u)\le dis(v)+c_k$ 即 $dis(u)-dis(v)\le c_k$ 对任意边都成立，**直接令 $x_u=dis(u)$** 就能保证满足全部约束. 值得注意的是，这组解保证了**每个** $x_u$ 最小（由 $x_u\le dis(u)$），因此也保证了所有 $x_u$ 的**和**最小，这将成为一些题的依据. 

有几个细节问题，由于并不困难，故略（懒得写）. 

---

3月18日 hjy 模拟赛笔记：

hjy 写的题解太抽象了. 只可意会. 不要试图进行长难句分析，要**感受**. 

T1（限制）是简单 dp，一开始想复杂了，浪费了 2h. 后来回头看，很快就切了. 这告诫我们不要在前面的题死磕太久，**一定要确保每道题都想过后再深入思考**. **不要总觉得自己马上就能做出来**.（由于一开始我以为复杂度是三次方，我甚至写了滚动数组以过部分分. 其实它直接就是对的.）

由于题目限制了 $a$ 的全体和为 $n$ 以及 $a$ 恰有 $k$ 个区间和为 $c$，很容易想到前缀和转化. 设 $a$ 的前缀和数组为 $S$，则原有的三个限制变成：$S$ 严格单增；$S_0=0$，$S_{|a|}=n$；恰有 $k$ **对** $(S_i,S_j)$ $(0\le i,j\le |a|)$ 满足 $S_j-S_i=c$. 很显然 $S$ 的顺序已经无所谓了（子区间和变成了单点差），不妨把 $S$ 看成集合（因为没有重复元素），其中必有 $0$ 和 $n$，其他数都在二者之间，可以随便定. 

注意到，如果把 $S$ 中的数按模 $c$ 的余数分成 $c$ 类，则满足条件的数对 $(S_i,S_j)$ 一定在同一个类中（因为二者的差为 $c$）. 换句话说，**有贡献的数对不会跨类**. 进一步地，在每个类内部按大小排序，则**只有相邻两数会产生贡献**. 

把这些类“拍”成一行，使拍成的序列中原先每类的数都相邻（即 $0,c,2c,\cdots,\lfloor\dfrac nc\rfloor c,1,c+1,2c+1,\cdots$）. 通俗地说就是先画一个以 $c$ 为周期的数表（第一行是 $0\sim c-1$，第二行是 $c\sim 2c-1$，……，类似元素周期表），然后**竖着看**. 这样问题变成：在序列中任意选择一些数（除了 $0$ 和 $n$ 必选），使得恰有 $k$ 对相邻（不算两周期接起来的位置），求方案数.（这段我嫌放图麻烦废话很多，其实画个图就理解了.）

设 $f_{i,j,0/1}$ 表示考虑数列的前 $i$ 项（下标从 $0$ 到 $n$）、有 $j$ 对贡献（相邻且同类）、不选/选位置 $i$ 的方案数. 
$$
f_{i,j,0}=f_{i-1,j,0}+f_{i-1,j,1}\\
f_{i,j,1}=f_{i-1,j,0}+[j>0]f_{i-1,j-1,1}
$$
一些细节：

- 如果当前的 $i$ 是该纵列最下面的元素（可以写一些模、除之类的判断，也可以预处理），则它**一定是无后效性的**（选不选和下一个位置都不构成一对贡献），因此把 $f_{i,j,1}$ 加到 $f_{i,j,0}$ 上并清零即可. 
- 为了钦定 $0$ 必选，可直接令 $f_{0,0,1}=1$ 且 $f_{0,0,0}=0$ 作为初始条件. 
- 为了钦定 $n$ 必选，可特判 $n$ 处对 $f$ 特殊处理，但要注意 $n$ 不一定是最后一个 dp 到的. 赛时我直接对 $n+1$ 和 $n$ 做两遍 dp 把答案相减容斥出答案.（我都觉得我很聪明！）

T2 我赛时几乎要想到了（写对了求集合的部分），除了 Hall 定理. 部分分太烂，误了 40pts. 这告诫我们，**对于没有数据验证的代码，千万不能相信自己的瞪眼能力，要倍加谨慎**. 

**Hall 定理**：设有二部图 $(L,R)$，定义**完美 $k$ 匹配**为：每个左部点都匹配 $k$ 个邻接的右部点，并且它们之间不相重复. 则完美 $k$ 匹配**存在当且仅当**

$$
\forall S\sube L,\ \left|\bigcup_{u\in S}T_u\right|\ge k\left|S\right|
$$
其中 $T_u$ 表示左部点 $u$ 的所有邻接点，有 $T_u\sube R$. 

我并不想研究它的证明，故证明略. 必要性是显然的，因此可以通过必要性来记忆定理. 这就是说：如果**对于任意一组左部点，与之相连的右部点都足够多（达到左部点数的 $k$ 倍）**，那么**完美 $k$ 匹配就存在**. 至于怎么找到这个匹配，就不是我们（或者说 Hall 定理）需要干的事了. 

回到本题. 首先注意到**汇合点一定是所有起始点的 LCA**. 通过**乱搞**（树上莫队、树剖之类的）求出每个起始点到 LCA 经过的物品集合（bitset 压位），然后就变成了完美 $k$ 匹配问题：$L$ 是人，$R$ 是物品，若某人能拿某物品就连边，希望总物品数（每个人拿的物品数 $k$ 乘 $c$）最大. 这里是要求 $k$ 的最大值，由于 $c$ 足够小，可以枚举左部点，用 bitset 求出对应右部点，二者的大小相除，取商的最小值即为 $k$. 

这里应当补充“扫描线”求集合的方法. 方法很简单，只是利用了离线省空间. 先略了. 

T3 很有意思. 首先是一般树的**三度化**——转成二叉树，使得分治可行（点分治比较麻烦，边分治是保证复杂度）. 然后是对于正负的巧妙设计. 懒得写了，看题解吧. 

---

3月25日广州二中模拟赛笔记：

题解太差了. 比上周 hjy 写的差多了. 不要试图进行长难句分析，不要试图感受，**作者根本没学过语文**. 

看见了吧，这就是停文化课的后果.（

T1 是简单状压 dp，有一个前缀和优化的小技巧. **别想复杂**. 要精准清空. 

T2 是扫描线，但是无法直接维护，要用到平面图面计数的**欧拉公式**
$$
V-E+F-C=1
$$
其中 $F$ 为**面数**，$C$ 为连通块个数. 由于这是网格图的一部分，有 $E=2V-n$，其中 $n$ 为线段数（输入）. $V$ 的求解是经典扫描线，$C$ 要在扫描线的过程中**维护并查集**，并查集中的点是**线段**（输入）. 可以**用线段树维护区间并查集合并**.（也可以再用一个“并查集”，实质是路径压缩的双向链表.）

T3 没看题. 

---

（近些天的）其他零散的感受：

打比赛**切莫眼高手低**. 拿一分是一分. 

很多人并没有你想象的那样强，或者至少他们是可以追赶的. **要有自信**. 

很多题并没有你想象的那样难，但它们很容易想复杂，这样不好. **别想复杂**. 

很多时候你想出来了 99% 却因为剩下那 1% 没做出来，这个时候应该庆幸而不是埋怨自己，因为补上 1% 总比补上 100% 要容易. **任何时候这都不是最后一次机会**. **别慌**. 

（hjy 你能不能别“这么猛”了. 我受不了了. 我已经被你们班“这么强！”折磨坏了.）

（哈哈哈哈哈哈反正你也看不着这些. 我可以随便骂.）

> 3月31日补充：这两天发现“这么猛”也挺可爱的. 仅限 hjy 和 smy. 

状态好多了. 未来的事就不要瞎操心了. 

---

3月27日（懒得一天一 commit 只好人工写下日期）

hjy 你都发烧了还想着打模拟赛呢. 烧糊涂了吧……

省选前好不了你就完了. 还是生病太少，没有警惕心，自以为自己很厉害，能恢复状态. 这就是平常身体不错的人的傲慢！（

---

来点活学活用，作为以后骂自己的素材：

> 重重的顾虑使我们全变成了懦夫，决心的赤热的光彩，被审慎的思维盖上了一层灰色，伟大的事业在这一种考虑下，也会逆流而退，失去了行动的意义. ——《哈姆莱特》

担心这个担心那个，瞻前顾后眼高手低，想那么多干啥啊……真是. 

感觉找回了一些自信. 果然自信对于状态的维持是极为重要的，一定要**相信自己在做的事是对的**. 

---

3月28日

果然我还是不怎么会（在言语上）关心人…… 好在这种情况下说什么不是很重要（

cq 让我看 qfoj.cn/d/rui_er__sqrt_7/p/3. 先拖着不看，明天再说.（谁教你题面写肾蕨的！）

smy 杂题选讲有 2 道神奇题，已补 T2（需要抽时间写题解），T1 仍需回味……

昨天写了 5*5 神奇状压 dp，又应用了**“从小往大填数”的技巧**. 

写了 n=70 更神奇状压 dp. 

**hjy 学第一定律**：“hhh”表示“我看到了/已阅/你说的是对的/哦/嗯”；“hhhhh”才表示“哈哈哈哈哈好好笑”.（更多的“h”可以表示非常非常好笑.）

**hjy 学第二定律**：连续的“h”数量为奇数的概率远大于偶数.（宇称不守恒？）

**hjy 学第三定律**：通常来讲左右括号应当匹配，但也有例外.（电荷守恒？）

> 解释一下为什么不叫“hjy 第几定律”：通常来讲第几定律前的人名是发现者，带上“学”字才代表定律的研究对象.（例如牛顿/孟德尔第一定律、热力学第一定律等.）

---

3月29日

hjy 身体好了，居然看着还挺精神的，不愧是 hjy，好得真快. 应当只是前一阵太累了. 

回味了 smy 杂题选讲 T1. **神**. 用巧妙的费用提前计算解决了后效性问题，省掉了一维状态，再按最短路算法的顺序更新状态，并维护凸壳均摊转移复杂度. 

近些天明显感觉到写代码能力显著提升. 还是**要多写**. 

---

3月31日

smy 居然也发烧了…… hjy 还咳得很厉害……

我到现在还没事，这已经是一个奇迹了，我就暗自庆幸吧. 

明天就省选了. 其实我也没啥压力，毕竟进不了队就没有不确定性（

---

4月1日

发挥得居然还不错，果然心态和自信是最重要的……

各种尝试安慰 hjy. 

担心 T1 有没有写挂. 

反思一下的话，就是**有什么想法/思路应该赶快写到纸上**，不要觉得不重要/没时间做. 本来最后剩下半小时完全够卡 T2 常的，结果因为脑子乱了不清晰，没卡完，损失 20pts.（当然这都是乐观情况，万一挂分就没这些事了.）

好消息：T1 T3 没挂. 坏消息：T2 挂了. 好消息：T2 没有完全挂. 

挂多少看~~天意~~ ccf 数据. 多则 25，少则不挂. 
$$
100+45+48=193
$$

$$
100+20+48=168
$$

比想象中好很多啊，看来. 

T3 能一眼秒 48 全靠 smy 和 hjy 前一阵给我速通了 Dsu on Tree……（但是 hjy 没想到就很可惜啊！！！）所以 hjy 和 smy 在 oi 上真的给了我很大很大的帮助，帮他们补 whk 是当然应该做的事，无论是理性上还是感情上.（求你们这些不搞 oi 的别问我竞赛集训情况/为什么不停课/小黄文化课怎么办/小黄落下的课找谁补/……了！！！我真的已经烦死了！！！！！以后再问回答一律是：搞什么竞赛，傻子才搞竞赛，我才不学竞赛呢！）

---

4月2日

（听得出 hjy 咳嗽少多了. 好得真快.）

今天 T1 的事我不想写了，这事我能记一辈子. 

谁能想到这么巧，去年 7 月打过 ABC261H 原题，但我和 hjy 都没认真研究题解；今年 2 月模拟赛也有原题，但我恰好去医院了没打（hjy 去上 zhengrui 也恰好没打）；省选考场上又给碰见了. 这就是**命运**啊！

> 【问题】给定有向图 $G$，初始在起点 $s$ 有一个棋子. Alice 和 Bob 轮流操作，每次将这枚棋子沿有向边移到相邻点，无法移动的人输. 判断游戏的结果是哪方获胜或平局（无法终止）. 

【分析】由于 Alice 和 Bob 的身份是没有区别的，因此我们可以将每个点区分为“**必胜点**”“**必败点**”“**平局点**“三种之一. 在求解过程中，初始所有点的种类都**未确定**，我们可以以任意顺序进行如下操作（称点 $u$ 能直接到达的点为 $u$ 的邻接点）：

- 若点 $u$ 的**所有邻接点都已确定是必胜点**（或点 $u$ 无邻接点），将其设为必败点. 
- 若点 $u$ **存在一个邻接点已确定是必败点**，将其设为必胜点. 

它们的正确性显然. 下面要说明的是，如果无法进行上述两条操作，那么**未确定的点就是平局点**. 这是因为，对于最终未确定的点 $u$，由于无法进行操作，它的所有邻接点**都不是必败点、不都是必胜点**（即存在未确定的邻接点）. 如果此时走棋的人位于 $u$，他显然不会往必胜点走，但又走不到必败点，因此只能（并且一定可以）走到另一个未确定的点. 因此，无论走多少步，棋子永远在未确定的点上，这就说明这些点就是平局点. 

【解法】建反图. 找到任意一个入度为零的点 $u$，将 $u$ 设为必败点，将 $u$ 的所有（反图上的）邻接点设为必胜点，并把它们一并从反图上删去. 直到反图中不存在入度为零的点，终止算法. 可用队列维护这个过程，复杂度线性. 

> 【问题加强版】若起点 $s$ 是非平局点，必胜方希望以最少的步数胜利，必败方希望以最多的步数失败，求两人在最优策略下游戏终止时的总步数 $d(s)$. 

【解法】删去点 $u$ 时更新 $u$ 的所有邻接点的 $d$ 值即可. 

---

4月12日

smy 进队了. 

居然真的进队了！

仿佛活在梦里一样……

（担心 hjy 的心理状态……）

---

4月22日

期中考前最后一天周末在家看抽代. 不愧是我！

如果有一个“最丑数学”排行榜，那么**高中导数大题**一定是榜首. 

---

4月24日

终于get到商群为什么叫商群了！同时也感受到第一同构定理在干什么了！……

都是明天数学不考的东西（（

---

5月11日 xcs 杂题选讲笔记：

**同余最短路**

> 【问题】完全背包：给定 $n$ $(n\le 10^3)$ 个物品，物品 $i$ 有体积 $v_i$，保证 $v_1\le 10^3$. $Q$ $(Q\le 10^6)$ 次询问，每次给定 $V$ $(V\le 10^{18})$，判断能否恰好装满大小为 $V$ 的背包.（类似洛谷 P2371）

【分析】本题的特点是：背包容量极大；存在一个小物品；不用计数，只需求是否可行. 

容易想到设 $dp[i]$（$0$ 或 $1$）表示能否恰好凑够体积 $i$，但 $V$ 太大了. 注意到，若 $dp[i]=1$，则一定有 $dp[i+v_1]=1$. 换句话说，若把下标 $v$ 模 $v_1$ 分成若干等价类，则在每一类的 $dp$ 值中若出现 $1$，后面就全是 $1$. 因此不妨设 $f[i]$ 表示模 $v_1$ 余 $i$ 的等价类中 $dp$ 值有多少个 $0$，即 $f[i]:=\min\{k:dp[i+kv_1]=1\}\ (0\le i<v_1)$. 初值令 $f[i]\leftarrow \infin$，$f[0]\leftarrow0$. 转移为 $f[(i+v_j)\mathrm{mod}\ v_1]\overset{min}\longleftarrow f[i]+\lfloor(i+v_j)/v_1\rfloor$，即向已有的 $i+f[i]v_1$ 体积加进去一个物品 $j$. 转移成环，因此不能直接递推；但注意到上述初值和转移符合图的最短路模型. 因此，设有向图 $G=(V,E)$，其中 $V=\{0,1,\cdots,v_1-1\}$，$E=\{(i,(i+v_j)\mathrm{mod}\ v_1,\lfloor(i+v_j)/v_1\rfloor)\}$，起点 $s=0$，则 $s$ 到点 $i$ 的最短路就是 $f[i]$. 给定 $V$，答案为 $[V\ge f[V\ \mathrm{mod}\ v_1]v_1]$. 

【解法】注意到边权非负，在图 $G$ 上跑 Dijkstra 即可求出 $f$，之后可以 $O(1)$ 查询. 点数 $v_1$，边数 $nv_1$，复杂度 $O(nv_1\log v_1+Q)$. 

> 【问题】THUPC 2023 背包：给定 $n$ 种物品，物品 $i$ 有体积 $v_i$、价值 $c_i$，每个物品可以使用任意多次. $Q$ 次询问，每次给定背包大小 $V$，判断能否恰好装满，以及装满的最大价值.（洛谷 P9140）
>
> 【数据范围】$n\le50$，$v_i\le10^5$，$c_i\le10^6$，$q\le10^5$，$10^{11}\le V\le 10^{12}$. 

【分析】注意到 $V$ 远大于 $v_i$，这启发我们先尽量多放性价比最高的物品，再用其他物品补满背包（可以替换之前放的物品）. 设性价比最高的物品为 $(v_1,c_1)$，因为 $V$ 很大，最优解一定有至少一个物品 $1$（后面会严格分析）. 

设 $f[i]$ $(0\le i<v_1)$ 表示背包容量为 $i$ 时的答案，但额外允许用 $c_1$ 的价值“买” $v_1$ 的大小（即取出一个物品 $1$）. 初值令 $f[i]\leftarrow-\infin$，$f[0]\leftarrow0$. 转移为 $f[(i+v_j)\mathrm{mod}\ v_1]\overset{max}\longleftarrow f[i]+c_j-\lfloor(i+v_j)/v_1\rfloor c_1$，即向已有的剩余容量 $(i+v_j)\mathrm{mod}\ v_1$ 的背包加入物品 $j$，并取出 $\lfloor(i+v_j)/v_1\rfloor$ 个物品 $1$. 类似上一题，设有向图 $G=(V,E)$，其中 $V=\{0,1,\cdots,v_1-1\}$，$E=\{(i,(i+v_j)\mathrm{mod}\ v_1,c_j-\lfloor(i+v_j)/v_1\rfloor c_1)\}$，起点 $s=0$，则 $s$ 到点 $i$ 的最长路就是 $f[i]$. 给定 $V$，答案为 $f[V\ \mathrm{mod}\ v_1]+\lfloor V/v_1\rfloor c_1$. 

由于存在正边，应当证明最长路存在，即不存在正环. 这是容易的，因为绕环走一圈相当于把若干物品 $1$ 替换成了等体积的其他物品，如果收益为正就违背了物品 $1$ 性价比最高的前提. 

下面分析为什么可以假定物品 $1$ 足量：最长路的边数不超过 $v_1-1$，而每条边代表的转移只放进一个物品，因此放进物品的总体积不超过 $(v_1-1)v_\mathrm{max}$. 由数据范围知，这个体积小于 $V$，因此背包里总有物品 $1$. 

【解法】点数 $v_1$，边数 $nv_1$，直接跑 SPFA 的复杂度为 $O(nv_1^2+Q)$，可以通过原题数据，但存在 hack. 

【优化】注意到放入物品的顺序是可交换的. 因此，可以强制按 $j$ 递增的顺序放物品 $(v_j,c_j)$（即松弛物品 $j$ 的所有边）. 具体来说，可以跑 $n$ 遍 SPFA，第 $j$ 轮只松弛所有物品 $j$ 的边（即在子图上跑 SPFA），可交换的性质保证了正确性（即 $j$ 之前的边不会再变“松”）. 第 $j$ 轮松弛时，子图由所有物品 $j$ 的边构成，每个点恰有一条出边，也恰有一条入边，因此图是若干个环. 在这个特殊的图上跑 SPFA，复杂度是 $O(v_1)$ 的，因为每个环最多松弛两圈（想一想，为什么）. 这样总的复杂度是 $O(nv_1+Q)$，可以通过. 

---

AT_code_festival_2017_qualb_f 题解：

设 $f(a,b,c,A,B,C)$ 表示 $a$ 个串 $A$、$b$ 个串 $B$、$c$ 个串 $C$ 按题目要求拼起来得到的答案串，要求 $A<B<C$. 则答案为 $f(X,Y,Z,$`a`$,$`b`$,$`c`$)$. 

递归地计算 $f(a,b,c,A,B,C)$（记为 $S$）. 显然 $S$ 以 $A$ 开头，记作 $S=A...$（除非 $a=0$，这时可利用 $f(a,b,c,A,B,C)=f(b,c,0,B,C,\varnothing)$）. 接下来考虑 $S$ 的第二位. 分三种情况：

- $c\ge a$：$S=AC...$，即 $S$ 中每个 $A$ 后都紧接着 $C$，因此 $S$ 可由 $AC$、$B$、$C$ 三种串拼接而成，$S=f(a,b,c-a,AC,B,C)$. 
- $c<a,\ c+b\ge a$：$S=AB...$，即 $S$ 中每个 $A$ 后接 $C$ 或 $B$

---

AT_agc017_c 题解：

记 $a[i]$ 表示有几个球是 $i$. 记 $s$ 为 $a$ 的前缀和. 

把“修改数字”看成“删一个数字”和“加一个数字”. 原问题即：先将 $a$ 任意自减若干次，再自增尽量少次（答案即最少自增次数），使 $\forall a[i]>0,\ s[i]=i$. 考虑在什么地方自增（显然自增的位置都是没有自减过的）. 我们可以证明，**存在一种最优解只在 $0$ 上自增**.（注意这蕴含了每个位置最多自增一次，因为在 $0$ 上的第二次自增就不是在 $0$ 上自增了.）

> **证明&emsp;**假设在某个 $a[i]>0$ 上自增，设 $a$ 与 $s$ 是取消这一次自增后的相应数组. 有 $s[i]=i-1$，且 $i$ 以前的位置都合法. 因此有 $s[i-d]\le s[i]-a[i]<i-a[i]$，当 $1\le d\le a[i]$ 时，$s[i-d]<i-d$，根据合法性的要求，$a[i-d]=0$. 因此，$s[i-a[i]]=s[i]-a[i]=i-1-a[i]$（因为中间这些项全是 $0$）. 也就是说，在 $a[i-a[i]]=0$ 上自增，恰好也可以满足全部要求，即无须在非 $0$ 数上自增. 

考虑 dp. 设 $f[i]$ 表示只考虑 $a[1\sim i]$，可以随便自减，最少自增几次能使 $1\sim i$ 合法. 分两类讨论：

- $a[i]=0$：$f[i]=f[i-1]+1$. 
- $a[i]>0$：$f[i]=$

> 略掉了. 详情请看与 hjy 的聊天记录. 

---

6月3日

搞出了一些容斥系数. 详情见几页破草稿纸、大群以及和 smy 的聊天记录. 

> Todo: 假期找时间整理！

---

6月6日

一个人在家里，心态有点不稳定. 或许我本应该（should have done）去成都的……

> 6月18日注：今天钱全退回来了，开心（

---

6月7日

领悟了线段树优化建图（<https://www.luogu.com.cn/blog/forever-captain/DS-optimize-graph>）. 事实上，这种添加中间节点优化建图的思想，早已出现很多次，例如电路设计（排序网络等）、一些网络流建模方式（“超级节点/关键节点”）、圆方树，以及高中地理的某道题. 

---

6月8日

出去瞎溜达，感受到一些东西（

上回在南京玄武湖，hjy（似乎是）讲的那道背包，因为要用bitset优化所以不能记录从哪转移过来，但可以先dp完再根据dp值在min/max里是否“紧”来追溯转移路径. 

其实所有min/max型dp都可以这么求路径（而完全不用记录from），这样的正确性是显然的. 它的本质是所有dp边中删掉“松”的边（非转移边），留下一个**转移图**（包含所有“紧”的转移边）——这玩意很眼熟，实际上“**最短路图**”就是这么个东西. 也就是说，这玩意不仅能做DAG型的dp，对于有环状转移的dp也是成立的. 这就是为什么“魔改Dijkstra做最短路径计数”这玩意很蠢，因为我们已经知道，完全没必要一边转移一边记录转移，直接跑最短路板子完了之后在最短路图上dp就行了. 

这其实是“任何最优化dp都能做**最优方案计数**”的原理. 若转移图是DAG，直接在DAG上dp求路径数即可（当然可以不显式地建出这个DAG，随转移一并计算，即我们通常写的最优方案计数）；若转移图有环，这个环一定是**零环**，此时最优方案有无限多. 

那么，这个转移图长什么样？在图中，从起点开始的任意一条路径都是最优转移，长度就是终点的dp值. 每条边都是“紧”的，不在图中的边都是“松”的. 做个类比（analogy），dp值可以看作该点的势能，沿转移边的任何路径长度只与初末势能有关、与路径无关——保守力做功，路径长度等于势能差. 沿非转移边走会更长一些，类比过来是外界对物体多做了额外功，就好像存在摩擦力一样. 

具体地，我们可以通过让每条边边权减去两端的势能差，求得每条边的“摩擦力”. 这得到了一个新图，新图**无负权边**，所有转移边为零、非转移边为正. 每个点的“势能”均为零，即任意一条最短路长度均为零——不仅如此，新图与原图的最短路一一对应. 这个操作在hjy某道杂题里有应用，同时Johnson全源最短路也使用它消去负边（以应用Dijkstra）. 

> 本质上是，这个操作保证了任意两条端点相同的路径的**长度差**不变，因此最短关系不变. 

---

6月18日

Todo: 应当列一个**计数题**题单. 最近做了不少计数题，感觉门道很多，还没太找到感觉. 

---

6月23日

祝yzj中考顺利！

---

很明显“推式子”的背后有什么本质的东西，然而我找不到. 不得不淹没在繁复的变量转换之中……

---

今天早上重新想了一下Pólya定理的证明，感觉好简单. 这里从头到尾写一下简要思路. 

> 用等价关系引入陪集，别觉得奇怪.（

**Burnside 引理速通**

前置知识：知道群和子群的定义. 

**一、同余**

设群 $G$ 有子群 $H$，对 $a,b\in G$ 定义**同余**关系 $a\equiv b\Leftrightarrow a^{-1}b\in H$. 下验证 $\equiv$ 是 $G$　上的一个**等价关系**：

- **自反性**：$a^{-1}a=e\in H$（子群包含幺元）. 
- **对称性**：$a^{-1}b\in H\Rightarrow b^{-1}a=(a^{-1}b)^{-1}\in H$（子群元素可逆）. 
- **传递性**：$a^{-1}b\in H\land b^{-1}c\in H \Rightarrow a^{-1}c=(a^{-1}b)(b^{-1}c)\in H$（子群封闭）. 

> 这里省略了 $(\mathrm{mod}\ H)$. 特别地，取 $G=\Z^+$，$H=m\Z$，此时 $\equiv(\mathrm{mod}\ m\Z)$ 即为数论中的 $\equiv (\mathrm{mod}\ m)$. 

若 $a\equiv b$，则称 $a$ 与 $b$ 属于同一个**等价类**. 由上述三个性质可知，所有等价类构成了 $G$ 的一个**划分**. 

> 集合上的一个等价关系确定一个划分，它是所有等价类的集合，集合的每个元素被恰好一个等价类包含. 

**二、陪集**

首先引入群 $G$ 中元素与集合的乘法. 对 $a\in G$ 及 $K\sube G$ ，定义 $a$ 和 $K$ 的**（左）乘积**  $aK:=\{ak:k\in K\}$. 显然有 $eK=K$. 结合律 $a(bK)=(ab)K$ 成立，这是因为
$$
\begin{align}
a(bK)=a\{bk:k\in K\}=\{a(bk):k\in K\}=\{(ab)k:k\in K\}=(ab)K.
\end{align}
$$

由 $aK$ 的生成方式，$|aK|\le|K|$，但另一方面 $K=eK=(a^{-1}a)K=a^{-1}(aK)$，所以对称的结论 $|K|\le |aK|$ 也成立，因此 $|aK|=|K|$. 

> 形象地讲，由于群中元素均可逆，左乘 $a$ 并没有使 $K$ “丢失信息”. 

回到关于同余关系的讨论上来. 设群 $G$ 有子群 $H$，对 $a\in G$，考虑有哪些 $b$ 与 $a$ 同余：
$$
\begin{align}
a\equiv b&\Leftrightarrow a^{-1}b\in H
\\&\Leftrightarrow a^{-1}b=h,&\exist h\in H
\\&\Leftrightarrow b=ah,&\exist h\in H
\\&\Leftrightarrow b\in\{ah:h\in H\}
\\&\Leftrightarrow b\in aH.
\end{align}
$$

因此，$a$ 所在的等价类就是 $aH$. 我们称 $aH$ 为 $H$ 的一个**（左）陪集**. 陪集的集合 $G/H:=\{aH:a\in G\}$ 称作**商集**，它就是同余关系 $\equiv$ 所确定的 $G$ 的划分. 商集的大小 $|G/H|$ 也称**指数**，记作 $[G:H]$，它就是等价类（陪集）的个数. 

> 这里默认 $G$ 是有限群，下同. 

由之前我们证明的，$|aH|=|H|$，可知所有陪集都一样大. 而这些陪集构成对 $G$ 的划分（不重不漏地包含 $G$ 的每个元素），因此陪集数乘陪集大小就等于 $G$ 的大小，即
$$
|G|=|H|[G:H]. 
$$
这便是**拉格朗日定理**. 

**三、群作用**

对非空集合 $S$，在 $S$ 上可定义**映射** $S\mapsto S$. 设群 $G$ 是由若干映射 $g:S\mapsto S$ 和映射的**复合**运算 $\circ$ 构成的群. 

- 结合律：$h\circ (g\circ f)=(h\circ g)\circ f$ 总是成立，这是因为两边都把 $s\in S$ 映到 $h(g(f(s)))$. 
- 幺元：恒等映射 $\mathrm{id}_S\in G$ 把任何一个 $s\in S$ 映到自身，有 $f\circ\mathrm{id}_S=\mathrm{id}_S\circ f=f$. 
- 逆元： $G$ 中元素可逆，因此这些映射都是**双射**，称作 $S$ 上的**变换**（因 $S$ 是有限集，也称**置换**）. 对 $f\in G$，$f$ 的逆元就是其逆映射 $f^{-1}$，有 $f\circ f^{-1}=f^{-1}\circ f=\mathrm{id}_S$. 

映射的复合是群 $G$ 元素的乘积，因此 $g\circ f$ 通常简写成 $gf$；恒等映射 $\mathrm{id}_S$ 是群 $G$ 的幺元，因此也记作 $e$. $f(s)$ 又称元素 $f$ 对 $s$ 的**作用**，省略括号记成 $fs$. 这样，群 $G$ 在 $S$ 上的**作用**满足两条性质：

- 幺元是恒等映射：$es=s$. 
- 结合律：$g(fs)=(gf)s$. 

对于**置换群** $G$，集合 $S$ 又称**指标**集合. 

**四、轨道**

设群 $G$ 作用于集合 $S$. 现在固定某个 $s\in S$，我们来研究 $G$ 的元素对 $s$ 的作用. 

考虑 $G$ 中每个元素对 $s$ 的作用，它们构成的集合称为 $s$ 的**轨道**，记作 $O_s$，即 $O_s:=\{gs:g\in G\}$. $O_s$ 是 $S$ 的子集. 

> 模仿之前对元素和集合的乘法的记号，$s$ 的轨道理应记作 $Gs$，代表每个 $g\in G$ 与 $s$ 的乘积，然而这个符号跟稳定子 $G_s$ 过于相似，还是不要用为好. 

下面我们来说明，$S$ 的所有元素的轨道构成 $S$ 的划分. 

- 自反性：$s=es\in O_s$. 
- 对称性：$t\in O_s\Rightarrow t=gs,\ \exist g\in G\Rightarrow s=g^{-1}t,\ \exist g\in G\Rightarrow s\in O_t$. 
- 传递性：$p\in O_t\land t\in O_s\Rightarrow p=gt\land t=fs,\ \exist g,f\in G\Rightarrow p=(gf)s,\ \exist g,f\in G\Rightarrow p\in O_s$. 

**五、稳定子**

设群 $G$ 作用于集合 $S$，依然固定某个 $s\in S$，研究 $G$ 的元素对 $s$ 的作用. 

考虑所有使 $s$ 不变的映射 $g\in G$，它们构成的集合称为 $s$ 的**稳定子**，记作 $G_s$，即 $G_s:=\{g\in G:gs=s\}$. 下面我们来证明，$G_s$ 是 $G$ 的子群. 

- 封闭性：$gs=s\land fs=s\Rightarrow (gf)s=s$. 
- 幺元：$es=s$. 
- 逆元：$gs=s\Rightarrow g^{-1}gs=g^{-1}s\Rightarrow s=g^{-1}s$. 

既然稳定子 $G_s$ 是一个子群，如前所述，它的所有陪集确定了 $G$ 的划分 $G/G_s$. 

依据对 $s$ 的作用是否相同（显然这是个等价关系），可以确定 $G$ 的一个划分. 对 $g,f\in G$，
$$
\begin{align}
gs=fs&\Leftrightarrow f^{-1}gs=f^{-1}fs
\\&\Leftrightarrow (f^{-1}g)s=s
\\&\Leftrightarrow f^{-1}g\in G_s
\\&\Leftrightarrow g\equiv f\ (\mathrm{mod}\ G_s).
\end{align}
$$
因此，这个划分就是 $G/G_s$！换句话说，$G_s$ 的陪集内的映射将 $s$ 映到同一元素，陪集间的映射将 $s$ 映到不同元素.（此处应有一张图片.） $O_s$ 中的元素与 $G_s$ 的陪集一一对应，即
$$
|O_s|=[G:G_s].
$$
这就是**轨道稳定子定理**. 

代入拉格朗日定理 $|G|=|G_s|[G:G_s]$，我们有
$$
|G|=|G_s||O_s|.
$$
轨道大小乘稳定子大小等于 $G$ 的大小. 

**六、Burnside 引理**

设群 $G$ 作用于集合 $S$. 现在希望对 $S$ 的等价类计数，即求轨道数. 通常对等价类计数的方式是计算代表元的数量，即让代表元贡献 $1$，其他元素贡献 $0$，但此时这种方法难以起效. 好在，轨道大小是容易求得的，因此我们让每个元素 $s$ 贡献恰好 $\dfrac1{|O_s|}$ 即可. 则轨道数为
$$
\begin{align}
&\sum_{s\in S}\dfrac1{|O_s|}
\\=&\sum_{s\in S}\dfrac{|G_s|}{|G|}
\\=&\dfrac1{|G|}\sum_{s\in S}|G_s|
\\=&\dfrac1{|G|}\sum_{\substack{s\in S\\g\in G}}[gs=s]
\\=&\dfrac1{|G|}\sum_{g\in G}|S_g|.
\end{align}
$$
其中 $S_g:=\{s\in S:gs=s\}$，$|S_g|$ 为映射 $g$ 的**不动点**数量. 这就是 **Burnside 引理**. 它尤其适用于 $S$ 非常大而 $G$ 比较小的情境，此时虽然轨道数非常多，但是只需要枚举 $g\in G$ 就能计算轨道数. 

